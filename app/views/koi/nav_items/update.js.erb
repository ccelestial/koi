<% if resource.errors.any? -%>

  $.magnificPopup.instance.currItem.inlineElement.html("<%= escape_javascript render ("modal_nav_item") %>");

  // Rebind functionality
  $(document).trigger("ornament:tabs");
  $(document).trigger("ornament:toggles");
  $(document).trigger("ornament:enhance-forms");

  // Open the first tab with errors
  var $firstErrorField = $(".lightbox--content  .error-block").first()
  var $firstErroredTab = $firstErrorField.closest("[data-tab-for]");
  var firstErroredTabId = $firstErroredTab.attr("data-toggle");
  var $tabAnchorForFirstError = $(".lightbox--content [data-toggle-anchor=" + firstErroredTabId + "]");
  $tabAnchorForFirstError.click();

<% else %>
  $.magnificPopup.close();
  $("#nav-item-<%= resource.id %>").replaceWith("<%= escape_javascript render("nav_item", nav_item: resource, level: resource.level) %>");
  $("#nav-item-<%= resource.id %> div:first").effect("highlight", {}, 3000);
<% end %>

